<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Compras Supermercado</title>

<style>
body{
  font-family: Arial, sans-serif;
  margin:0;
  background:#f4f6f9;
}
h1{
  text-align:center;
}
.container{
  max-width:900px;
  margin:auto;
  padding:10px;
}
input, button{
  padding:6px;
  font-size:14px;
}
.categoria{
  background:#1e88e5;
  color:white;
  padding:10px;
  margin-top:20px;
  border-radius:8px;
}
.producto{
  display:grid;
  grid-template-columns: 2fr 1fr 1fr 1fr auto;
  gap:5px;
  background:white;
  padding:6px;
  margin-top:5px;
  border-radius:6px;
  align-items:center;
}
.total-cat{
  text-align:right;
  font-weight:bold;
  margin-top:5px;
}
.total-general{
  font-size:20px;
  text-align:right;
  margin-top:20px;
  font-weight:bold;
}
.oculto{
  display:none;
}
hr{
  margin:20px 0;
}
</style>
</head>

<body>
<div class="container">
<h1>COMPRAS SUPERMERCADO</h1>

<input type="text" id="buscar" placeholder="Buscar producto..." oninput="filtrar()">
<label>
  <input type="checkbox" id="soloCantidad" onchange="filtrar()"> Solo con cantidad
</label>

<hr>

<h3>Alta de producto</h3>
<input id="nuevoNombre" placeholder="Nombre">
<input id="nuevaCategoria" placeholder="CategorÃ­a">
<button onclick="agregarProducto()">Agregar</button>

<div id="lista"></div>

<div class="total-general" id="totalGeneral">$0.00</div>
</div>

<script>
let productos = JSON.parse(localStorage.getItem("productos")) || [
  {nombre:"Res", categoria:"Carnes", cantidad:0, precio:0},
  {nombre:"Pollo", categoria:"Carnes", cantidad:0, precio:0},
  {nombre:"Manzana", categoria:"Frutas", cantidad:0, precio:0}
];

function guardar(){
  localStorage.setItem("productos", JSON.stringify(productos));
}

function agregarProducto(){
  const nombre = nuevoNombre.value.trim();
  const categoria = nuevaCategoria.value.trim();
  if(!nombre || !categoria) return;
  productos.push({nombre,categoria,cantidad:0,precio:0});
  nuevoNombre.value="";
  nuevaCategoria.value="";
  guardar();
  render();
}

function render(){
  const cont = document.getElementById("lista");
  cont.innerHTML="";
  let categorias = {};
  let totalGeneral = 0;

  productos.forEach((p,i)=>{
    if(!categorias[p.categoria]) categorias[p.categoria]=[];
    categorias[p.categoria].push({...p,index:i});
  });

  for(let cat in categorias){
    let totalCat = 0;
    cont.innerHTML += `<div class="categoria">${cat}</div>`;
    categorias[cat].forEach(p=>{
      let subtotal = p.cantidad * p.precio;
      totalCat += subtotal;
      totalGeneral += subtotal;

      cont.innerHTML += `
      <div class="producto" data-nombre="${p.nombre}">
        <strong>${p.nombre}</strong>
        <input type="number" min="0" value="${p.cantidad}" 
          oninput="productos[${p.index}].cantidad=this.value;guardar();render()">
        <input type="number" min="0" value="${p.precio}" 
          oninput="productos[${p.index}].precio=this.value;guardar();render()">
        <div>$${subtotal.toFixed(2)}</div>
        <input type="checkbox">
      </div>`;
    });
    cont.innerHTML += `<div class="total-cat">Total ${cat}: $${totalCat.toFixed(2)}</div>`;
  }

  document.getElementById("totalGeneral").innerText =
    "TOTAL GENERAL: $" + totalGeneral.toFixed(2);

  filtrar();
}

function filtrar(){
  const texto = buscar.value.toLowerCase();
  const solo = soloCantidad.checked;
  document.querySelectorAll(".producto").forEach(p=>{
    const nombre = p.dataset.nombre.toLowerCase();
    const cantidad = p.querySelector("input").value;
    let visible = nombre.includes(texto);
    if(solo && cantidad==0) visible=false;
    p.style.display = visible ? "grid":"none";
  });
}

render();
</script>
</body>
</html>
