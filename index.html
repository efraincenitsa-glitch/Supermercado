
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Supermercado PRO+</title>

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icons/icon-1024.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#2e7d32">

<style>
:root{
  --bg:#f2f4f8;--card:#fff;--text:#222;--primary:#2e7d32;
}
body.dark{--bg:#121212;--card:#1e1e1e;--text:#eee}
body{font-family:Arial;margin:0;background:var(--bg);color:var(--text)}
header{background:var(--primary);color:#fff;padding:15px;text-align:center;font-size:20px}
.container{padding:15px}
input,select,button{width:100%;padding:10px;margin-top:10px;font-size:16px;border-radius:6px;border:1px solid #ccc}
button{background:var(--primary);color:#fff;border:none}
.secondary{background:#555}
.danger{background:#c62828}
table{width:100%;margin-top:15px;border-collapse:collapse;background:var(--card)}
th,td{padding:8px;border-bottom:1px solid #ccc;font-size:14px}
tr.selected{background:#a5d6a7}
tr.surtido{text-decoration:line-through;opacity:0.6}
.total{font-size:18px;margin-top:10px;font-weight:bold}
.card{background:var(--card);padding:10px;border-radius:8px;margin-top:15px}
.flex{display:flex;gap:10px;align-items:center}
</style>
</head>

<body>
<header>üõí Supermercado PRO+</header>
<div class="container">

<select id="categoria" onchange="cargarProductos()"></select>
<select id="producto"></select>

<input type="number" id="cantidad" placeholder="Cantidad">
<input type="number" id="precio" placeholder="Precio unitario">

<div class="flex">
  <input type="checkbox" id="surtido">
  <label for="surtido">Producto ya surtido</label>
</div>

<button onclick="agregar()">Agregar / Actualizar</button>
<button class="secondary" onclick="altaCategoria()">Alta categor√≠a</button>
<button class="secondary" onclick="altaProducto()">Alta producto</button>
<button class="danger" onclick="eliminar()">Eliminar seleccionado</button>
<button class="secondary" onclick="exportar()">Exportar CSV</button>
<button class="secondary" onclick="toggleDark()">Modo oscuro</button>

<div class="flex">
  <input type="checkbox" id="verSurtidos" checked onchange="render()">
  <label for="verSurtidos">Mostrar productos surtidos</label>
</div>

<table>
<thead>
<tr>
<th>Categor√≠a</th><th>Producto</th><th>Cant.</th><th>Precio</th><th>Subtotal</th><th>Surtido</th>
</tr>
</thead>
<tbody id="lista"></tbody>
</table>

<div class="total">Total: $<span id="total">0</span></div>

<div class="card">
<b>Total por categor√≠a</b>
<ul id="totalesCat"></ul>
</div>

</div>

<script>
let categorias = JSON.parse(localStorage.getItem("categorias")) || {"Abarrotes": ["Arroz", "Frijol", "Lentejas", "Pasta", "Aceite", "Az√∫car", "Sal", "Harina", "Avena", "Cereal", "At√∫n", "Sardinas", "Mayonesa", "Mostaza", "Catsup", "Salsa", "Caldo de pollo", "Caldo de res", "Pan molido", "Gelatina"], "Frutas y Verduras": ["Manzana", "Pl√°tano", "Naranja", "Lim√≥n", "Mandarina", "Fresa", "Uva", "Tomate", "Papa", "Cebolla", "Zanahoria", "Lechuga", "Espinaca", "Br√≥coli", "Coliflor", "Pepino", "Aguacate", "Calabaza", "Chayote", "Jitomate"], "Carnes": ["Pollo entero", "Pechuga de pollo", "Muslo", "Carne de res", "Bistec", "Molida de res", "Carne de cerdo", "Costilla", "Chuleta", "Pescado", "Filete de pescado", "Camar√≥n", "Jam√≥n", "Salchicha", "Chorizo", "Tocino", "Longaniza", "Arrachera", "Milanesa", "Pierna"], "L√°cteos": ["Leche entera", "Leche light", "Leche deslactosada", "Queso panela", "Queso Oaxaca", "Queso manchego", "Yogurt natural", "Yogurt sabor", "Crema", "Mantequilla", "Margarina", "Huevo", "Leche evaporada", "Leche condensada", "Reques√≥n", "Queso crema", "Yogurt griego", "Flan", "Natilla", "Crema batida"], "Limpieza": ["Cloro", "Detergente", "Suavizante", "Jab√≥n de trastes", "Limpiador multiusos", "Desinfectante", "Limpiavidrios", "Fabuloso", "Pinol", "Escoba", "Trapeador", "Fibra", "Esponjas", "Bolsas de basura", "Insecticida", "Aromatizante", "Cloro en gel", "Pastillas WC", "Jab√≥n en polvo", "Quitamanchas"], "Higiene Personal": ["Shampoo", "Acondicionador", "Jab√≥n corporal", "Pasta dental", "Cepillo dental", "Enjuague bucal", "Desodorante", "Rastrillos", "Crema corporal", "Gel para cabello", "Algod√≥n", "Toallas sanitarias", "Papel higi√©nico", "Pa√±uelos", "Talco", "Protector solar", "Toallitas h√∫medas", "Crema facial", "Maquillaje", "Perfume"], "Bebidas": ["Agua natural", "Agua mineral", "Refresco cola", "Refresco sabor", "Jugo naranja", "Jugo manzana", "Bebida isot√≥nica", "Energ√©tica", "Caf√© molido", "Caf√© soluble", "T√©", "T√© helado", "Leche saborizada", "Cerveza", "Vino", "Licor", "Refresco light", "Agua saborizada", "Bebida vegetal", "Chocolate en polvo"]};
let datos = JSON.parse(localStorage.getItem("compras")) || [];
let seleccionado = null;

function init(){
  categoria.innerHTML = Object.keys(categorias).map(c=>'<option>'+c+'</option>').join("");
  cargarProductos(); render();
}

function cargarProductos(){
  producto.innerHTML = categorias[categoria.value].map(p=>'<option>'+p+'</option>').join("");
}

function agregar(){
  let obj = {
    categoria:categoria.value,
    producto:producto.value,
    cantidad:Number(cantidad.value),
    precio:Number(precio.value),
    subtotal:Number(cantidad.value)*Number(precio.value),
    surtido:surtido.checked
  };
  if(seleccionado!==null){ datos[seleccionado]=obj; seleccionado=null; }
  else datos.push(obj);
  guardar(); render();
}

function render(){
  let t=0, porCat={};
  lista.innerHTML="";
  datos.forEach((d,i)=>{
    if(!verSurtidos.checked && d.surtido) return;
    t+=d.subtotal;
    porCat[d.categoria]=(porCat[d.categoria]||0)+d.subtotal;
    lista.innerHTML+=`<tr onclick="sel(${i})" class="${d.surtido?'surtido':''} ${seleccionado===i?'selected':''}">
    <td>${d.categoria}</td><td>${d.producto}</td><td>${d.cantidad}</td>
    <td>$${d.precio}</td><td>$${d.subtotal}</td><td>${d.surtido?'‚úîÔ∏è':''}</td></tr>`;
  });
  total.innerText=t.toFixed(2);
  totalesCat.innerHTML = Object.keys(porCat).map(c=>'<li>'+c+': $'+porCat[c].toFixed(2)+'</li>').join("");
}

function sel(i){
  seleccionado=i;
  let d=datos[i];
  cantidad.value=d.cantidad; precio.value=d.precio; surtido.checked=d.surtido;
  render();
}

function eliminar(){
  if(seleccionado!==null && confirm("¬øEliminar producto?")){
    datos.splice(seleccionado,1); seleccionado=null; guardar(); render();
  }
}

function guardar(){
  localStorage.setItem("compras",JSON.stringify(datos));
  localStorage.setItem("categorias",JSON.stringify(categorias));
}

function altaCategoria(){
  let n=prompt("Nueva categor√≠a"); if(n){categorias[n]=[];guardar();init();}
}
function altaProducto(){
  let n=prompt("Nuevo producto"); if(n){categorias[categoria.value].push(n);guardar();cargarProductos();}
}
function exportar(){
  let csv="Categoria,Producto,Cantidad,Precio,Subtotal,Surtido\n";
  datos.forEach(d=>csv+=`${d.categoria},${d.producto},${d.cantidad},${d.precio},${d.subtotal},${d.surtido}\n`);
  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
  a.download="supermercado.csv"; a.click();
}
function toggleDark(){document.body.classList.toggle("dark");}

init();
</script>
</body>
</html>
