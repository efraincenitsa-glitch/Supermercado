
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Supermercado PRO</title>

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icons/icon-1024.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#2e7d32">

<style>
:root{
  --bg:#f2f4f8;
  --card:#ffffff;
  --text:#222;
  --primary:#2e7d32;
}
body.dark{
  --bg:#121212;
  --card:#1e1e1e;
  --text:#eee;
}
body{font-family:Arial;margin:0;background:var(--bg);color:var(--text)}
header{background:var(--primary);color:#fff;padding:15px;text-align:center;font-size:20px}
.container{padding:15px}
input,select,button{width:100%;padding:10px;margin-top:10px;font-size:16px;border-radius:6px;border:1px solid #ccc}
button{background:var(--primary);color:white;border:none}
.secondary{background:#555}
.danger{background:#c62828}
table{width:100%;margin-top:15px;border-collapse:collapse;background:var(--card)}
th,td{padding:8px;border-bottom:1px solid #ccc;text-align:left;font-size:14px}
tr.selected{background:#a5d6a7}
.total{font-size:18px;margin-top:10px;font-weight:bold}
.card{background:var(--card);padding:10px;border-radius:8px;margin-top:15px}
</style>
</head>

<body>
<header>游 Supermercado PRO</header>
<div class="container">

<select id="categoria" onchange="cargarProductos()"></select>
<select id="producto"></select>

<input type="number" id="cantidad" placeholder="Cantidad">
<input type="number" id="precio" placeholder="Precio unitario">

<button onclick="agregar()">Agregar / Actualizar</button>
<button class="secondary" onclick="altaCategoria()">Alta categor칤a</button>
<button class="secondary" onclick="altaProducto()">Alta producto</button>
<button class="danger" onclick="eliminar()">Eliminar seleccionado</button>
<button class="secondary" onclick="exportar()">Exportar CSV</button>
<button class="secondary" onclick="toggleDark()">Modo oscuro</button>

<table>
<thead>
<tr>
<th>Categor칤a</th><th>Producto</th><th>Cant.</th><th>Precio</th><th>Subtotal</th>
</tr>
</thead>
<tbody id="lista"></tbody>
</table>

<div class="total">Total: $<span id="total">0</span></div>

<div class="card">
<b>Total por categor칤a</b>
<ul id="totalesCat"></ul>
</div>

</div>

<script>
let categorias = JSON.parse(localStorage.getItem("categorias")) || {"Abarrotes": ["Arroz", "Frijol", "Lentejas", "Pasta", "Aceite", "Az칰car", "Sal"], "Frutas y Verduras": ["Manzana", "Pl치tano", "Naranja", "Tomate", "Papa", "Cebolla"], "Carnes": ["Pollo", "Carne de Res", "Carne de Cerdo", "Pescado"], "L치cteos": ["Leche", "Queso", "Yogurt", "Crema", "Huevo"], "Limpieza": ["Cloro", "Detergente", "Suavizante", "Jab칩n de Trastes", "Limpiador"], "Higiene Personal": ["Shampoo", "Jab칩n", "Pasta Dental", "Desodorante"]};
let datos = JSON.parse(localStorage.getItem("compras")) || [];
let seleccionado = null;

function init(){
  categoria.innerHTML = Object.keys(categorias).map(c=>'<option>'+c+'</option>').join("");
  cargarProductos();
  render();
}

function cargarProductos(){
  producto.innerHTML = categorias[categoria.value].map(p=>'<option>'+p+'</option>').join("");
}

function agregar(){
  let c = Number(cantidad.value);
  let p = Number(precio.value);
  if(seleccionado!==null){
    datos[seleccionado].cantidad=c;
    datos[seleccionado].precio=p;
    datos[seleccionado].subtotal=c*p;
    seleccionado=null;
  } else {
    datos.push({
      categoria:categoria.value,
      producto:producto.value,
      cantidad:c,
      precio:p,
      subtotal:c*p
    });
  }
  guardar(); render();
}

function render(){
  let t=0, porCat={};
  lista.innerHTML="";
  datos.forEach((d,i)=>{
    t+=d.subtotal;
    porCat[d.categoria]=(porCat[d.categoria]||0)+d.subtotal;
    lista.innerHTML+=`<tr onclick="sel(${i})" class="${seleccionado===i?'selected':''}">
      <td>${d.categoria}</td><td>${d.producto}</td><td>${d.cantidad}</td>
      <td>$${d.precio}</td><td>$${d.subtotal}</td></tr>`;
  });
  total.innerText=t.toFixed(2);
  totalesCat.innerHTML = Object.keys(porCat).map(c=>'<li>'+c+': $'+porCat[c].toFixed(2)+'</li>').join("");
}

function sel(i){
  seleccionado=i;
  cantidad.value=datos[i].cantidad;
  precio.value=datos[i].precio;
  render();
}

function eliminar(){
  if(seleccionado!==null && confirm("쮼liminar producto?")){
    datos.splice(seleccionado,1);
    seleccionado=null;
    guardar(); render();
  }
}

function guardar(){
  localStorage.setItem("compras",JSON.stringify(datos));
  localStorage.setItem("categorias",JSON.stringify(categorias));
}

function altaCategoria(){
  let n=prompt("Nueva categor칤a");
  if(n){categorias[n]=[];guardar();init();}
}
function altaProducto(){
  let n=prompt("Nuevo producto");
  if(n){categorias[categoria.value].push(n);guardar();cargarProductos();}
}

function exportar(){
  let csv="Categoria,Producto,Cantidad,Precio,Subtotal\n";
  datos.forEach(d=>csv+=`${d.categoria},${d.producto},${d.cantidad},${d.precio},${d.subtotal}\n`);
  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
  a.download="supermercado.csv";
  a.click();
}

function toggleDark(){
  document.body.classList.toggle("dark");
}

init();
</script>
</body>
</html>
